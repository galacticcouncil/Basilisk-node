<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Resource limiting. Create generic “resources” and configure their limits to ensure servers are not overloaded."><meta name="keywords" content="rust, rustlang, rust-lang, resource_limiting"><title>jsonrpsee_core::server::resource_limiting - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-e963ab4a0d0c903e.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../static.files/light-046227e470cd3629.css"><link rel="stylesheet" disabled href="../../../static.files/dark-800f2ee593c8e6f7.css"><link rel="stylesheet" disabled href="../../../static.files/ayu-9edae3c387f5a5b3.css"><script id="default-settings" ></script><script src="../../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../../static.files/main-287cecec4dbb45b0.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../jsonrpsee_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../jsonrpsee_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module resource_limiting</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../../index.html">jsonrpsee_core</a>::<wbr><a href="../index.html">server</a>::<wbr><a class="mod" href="#">resource_limiting</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/jsonrpsee_core/server/resource_limiting.rs.html#27-176">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Resource limiting. Create generic “resources” and configure their limits to ensure servers are not overloaded.</p>
<h2 id="resource-limiting"><a href="#resource-limiting">Resource Limiting</a></h2>
<p>This module handles limiting the capacity of the server to respond to requests.</p>
<p><code>jsonrpsee</code> is agnostic about the types of resources available on the server, and the units used are arbitrary.
The units are used to model the availability of a resource, be it something mundane like CPU or Memory,
or more exotic things like remote API access to a 3rd party service, or use of some external hardware
that’s under the control of the server.</p>
<p>To get the most out of this feature, we suggest benchmarking individual methods to see how many resources they
consume, in particular anything critical that is expected to result in a lot of stress on the server,
and then defining your units such that the limits (<code>capacity</code>) can be adjusted for different hardware configurations.</p>
<p>Up to 8 resources can be defined using the <a href="../../../jsonrpsee_ws_server/struct.WsServerBuilder.html#method.register_resource"><code>WsServerBuilder::register_resource</code></a>
or <a href="../../../jsonrpsee_http_server/struct.HttpServerBuilder.html#method.register_resource"><code>HttpServerBuilder::register_resource</code></a> method
for the WebSocket and HTTP server respectively.</p>
<p>Each method will claim the specified number of units (or the default) for the duration of its execution.
Any method execution that would cause the total sum of claimed resource units to exceed
the <code>capacity</code> of that resource will be denied execution, immediately returning JSON-RPC error object with code <code>-32604</code>.</p>
<p>Setting the execution cost to <code>0</code> equates to the method effectively not being limited by a given resource. Likewise setting the
<code>capacity</code> to <code>0</code> disables any limiting for a given resource.</p>
<p>To specify a different than default number of units a method should use, use the <code>resources</code> argument in the
<code>#[method]</code> attribute:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[rpc(server)]
</span><span class="kw">pub trait </span>Rpc {
    <span class="attr">#[method(name = <span class="string">&quot;my_expensive_method&quot;</span>, resources(<span class="string">&quot;cpu&quot; </span>= <span class="number">5</span>, <span class="string">&quot;mem&quot; </span>= <span class="number">2</span>))]
    </span><span class="kw">async fn </span>my_expensive_method(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; RpcResult&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str&gt; {
        <span class="comment">// Do work
        </span><span class="prelude-val">Ok</span>(<span class="string">&quot;hello&quot;</span>)
    }
}</code></pre></div>
<p>Alternatively, you can use the <code>resource</code> method when creating a module manually without the help of the macro:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span><span class="kw-2">mut </span>module = RpcModule::new(());

module
    .register_async_method(<span class="string">&quot;my_expensive_method&quot;</span>, |<span class="kw">_</span>, <span class="kw">_</span>| <span class="kw">async move </span>{
        <span class="comment">// Do work
        </span><span class="prelude-val">Ok</span>(<span class="string">&quot;hello&quot;</span>)
    })<span class="question-mark">?
    </span>.resource(<span class="string">&quot;cpu&quot;</span>, <span class="number">5</span>)<span class="question-mark">?
    </span>.resource(<span class="string">&quot;mem&quot;</span>, <span class="number">2</span>)<span class="question-mark">?</span>;</code></pre></div>
<p>Each resource needs to have a unique name, such as <code>&quot;cpu&quot;</code> or <code>&quot;memory&quot;</code>, which can then be used across all
<a href="../rpc_module/struct.RpcModule.html"><code>RpcModule</code>s</a>. In case a module definition uses a resource label not
defined on the server, starting the server with such a module will result in a runtime error containing the
information about the offending method.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ResourceGuard.html" title="jsonrpsee_core::server::resource_limiting::ResourceGuard struct">ResourceGuard</a></div><div class="item-right docblock-short">RAII style “lock” for claimed resources, will automatically release them once dropped.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Resources.html" title="jsonrpsee_core::server::resource_limiting::Resources struct">Resources</a></div><div class="item-right docblock-short">User defined resources available to be used by calls on the JSON-RPC server.
Each of the 8 possible resource kinds, for instance “cpu”, “io”, “nanobots”,
store a maximum <code>capacity</code> and a default. A value of <code>0</code> means no limits for the given resource.</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ResourceTable.html" title="jsonrpsee_core::server::resource_limiting::ResourceTable type">ResourceTable</a></div><div class="item-right docblock-short">Fixed size table, mapping a resource to a (unitless) value indicating the amount of the resource that is available to RPC calls.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ResourceVec.html" title="jsonrpsee_core::server::resource_limiting::ResourceVec type">ResourceVec</a></div><div class="item-right docblock-short">Variable size table, mapping a resource to a (unitless) value indicating the amount of the resource that is available to RPC calls.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="jsonrpsee_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.0-nightly (234151769 2022-12-03)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>